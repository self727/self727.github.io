<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <title>æœ‰ç“œæ•…äº‹ä¼š Â· ç¯å¢ƒé“¾æ¥æ±‡æ€»ï¼ˆå¯ç¼–è¾‘ + å®æ—¶åˆ·æ–°ï¼‰</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 2em; background: #f9f9f9; }
        section { margin-bottom: 2em; background: #fff; padding: 1em; border: 1px dashed #ccc; }
        h2 { color: #333; }
        ul { list-style: none; padding-left: 0; }
        li { margin-bottom: 0.5em; }
        a { color: #007acc; text-decoration: none; }
        a:hover { text-decoration: underline; }
        input[type="text"] { width: 60%; margin-right: 1em; }
        button { margin-top: 1em; }
    </style>
</head>
<body>
<h1>ğŸ‰ æœ‰ç“œæ•…äº‹ä¼š Â· ç¯å¢ƒé“¾æ¥æ±‡æ€»ï¼ˆå¯ç¼–è¾‘ + å®æ—¶åˆ·æ–°ï¼‰</h1>
<div id="container">åŠ è½½ä¸­...</div>
<button onclick="downloadJson()">ğŸ’¾ ä¿å­˜ä¸ºæ–°ç‰ˆæœ¬</button>

<script>
    const JSON_URL = 'https://web-1256805236.cos.ap-guangzhou.myqcloud.com/env.json';
    let currentVersion = 0;
    let currentData = {};

    async function fetchAndRenderIfUpdated() {
        try {
            const res = await fetch(JSON_URL + '?t=' + Date.now());
            const data = await res.json();
            if (data.version > currentVersion) {
                currentVersion = data.version;
                currentData = data;
                renderEditable(data);
            }
        } catch (err) {
            document.getElementById('container').innerHTML = 'âŒ åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ COS é…ç½®æˆ– JSON æ ¼å¼';
            console.error(err);
        }
    }

    function renderEditable(data) {
        const container = document.getElementById('container');
        container.innerHTML = '';

        Object.entries(data).forEach(([env, links]) => {
            if (env === 'version') return;

            const section = document.createElement('section');
            section.innerHTML = `<h2>${env}</h2><ul></ul>`;
            const ul = section.querySelector('ul');

            Object.entries(links).forEach(([label, url]) => {
                const li = document.createElement('li');
                li.innerHTML = `
          <input type="text" value="${label}" data-env="${env}" data-type="label" />
          <input type="text" value="${url}" data-env="${env}" data-type="url" />
        `;
                ul.appendChild(li);
            });

            container.appendChild(section);
        });
    }

    function downloadJson() {
        const inputs = document.querySelectorAll('input');
        const newData = { version: Date.now() };

        inputs.forEach(input => {
            const env = input.dataset.env;
            const type = input.dataset.type;
            const value = input.value;

            if (!newData[env]) newData[env] = {};
            if (type === 'label') {
                input.nextElementSibling.dataset.label = value;
            } else if (type === 'url') {
                const label = input.dataset.label || input.previousElementSibling.value;
                newData[env][label] = value;
            }
        });

        const blob = new Blob([JSON.stringify(newData, null, 2)], { type: 'application/json' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'env.json';
        link.click();
    }

    fetchAndRenderIfUpdated();
    setInterval(fetchAndRenderIfUpdated, 3000);
</script>
</body>
</html>
